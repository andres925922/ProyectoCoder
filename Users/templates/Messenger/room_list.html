{% extends 'Base/header.html' %}
{% load static %}
{% block title %}Mensajes{% endblock %}
{% block content %}
<style>
  .avatar  { width:50px; height:50px; float:left; margin-right:10px; }
</style>
<main role="main">
  <div class="container">
    <div class="row mt-3">
      <div class="col-md-9 mx-auto mb-5">
            <!-- Recorremos los Hilos  -->
        <!-- {% for i in rooms %}
            {{ i }}
        {% endfor %} -->
            <div class="col-md-4">
                <!-- Con una búsqueda inversa también podemos conseguir los hilos de un usuario -->
                {% for room in request.user.rooms.all %}
                  <!-- Sólo mostraremos un Hilo si tiene como mínimo 1 mensaje -->
                  {% if room.messages.all|length > 0 %}
                    <div class="mb-3">
                      <!-- Recorremos los miembros del hilo menos el propio request.user -->
                      {% for user in room.users.all %}
                        {% if user != request.user %}    
                          <!-- Mostramos la información del miembro --> 
                          <div>
                            <a href="{% url 'detailed' room.pk %}">{{user}}</a><br>
                          </div>
                        {% endif %}
                      {% endfor %}
                    </div>
                  {% endif %}
                {% endfor %}
            </div>
            <div class="col-md-4">
                <form action="">
                    <select name="usuario" id="">
                        {% for usr in all_users %}
                        <option value="{{usr}}">{{usr}}</option>
                        {% endfor %}
                    </select>
                    <a href="{% url 'newMsg' %}">
                        <input type="submit" value="Nuevo Mensaje">
                    </a>
                </form>

            </div>

      </div>
    </div>
  </div>
</main>
{% endblock %}